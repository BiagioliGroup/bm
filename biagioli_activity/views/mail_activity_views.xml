<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Extender vista form de mail.activity -->
    <record id="view_mail_activity_form_inherit" model="ir.ui.view">
        <field name="name">mail.activity.form.inherit.project</field>
        <field name="model">mail.activity</field>
        <field name="inherit_id" ref="mail.mail_activity_view_form_popup"/>
        <field name="arch" type="xml">
            <!-- Agregar campo de proyecto después del tipo de actividad -->
            <xpath expr="//field[@name='activity_type_id']" position="after">
                <field name="project_id" 
                       placeholder="Seleccionar un proyecto (opcional)"
                       options="{'no_create': True}"/>
            </xpath>
            
            <!-- Mostrar tarea vinculada si existe -->
            <xpath expr="//sheet/group[1]" position="after">
                <group string="Tarea Vinculada" invisible="not linked_task_id">
                    <field name="linked_task_id" readonly="1" nolabel="1"/>
                </group>
            </xpath>
        </field>
    </record>
    
    <!-- Vista tree/list para actividades con información de proyecto -->
    <record id="view_mail_activity_list_inherit" model="ir.ui.view">
        <field name="name">mail.activity.list.inherit.project</field>
        <field name="model">mail.activity</field>
        <field name="inherit_id" ref="mail.mail_activity_view_tree"/>
        <field name="arch" type="xml">
            <!-- Agregar columna de proyecto -->
            <xpath expr="//field[@name='user_id']" position="after">
                <field name="project_id" optional="show"/>
                <field name="linked_task_id" optional="hide"/>
            </xpath>
        </field>
    </record>
</odoo>