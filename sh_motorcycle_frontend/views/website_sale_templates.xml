<?xml version="1.0" encoding="utf-8"?>
<odoo>

  <!-- üõ†Ô∏è Tabla de compatibilidad vehicular -->
  <template id="sh_supported_vehicles" inherit_id="website_sale.product" active="True" customize_show="True" name="Supported Vehicles">
    <xpath expr="//div[@id='product_detail_main']" position="after">
      <div class="tab-pane" id="sh_supported" role="tabpanel">
        <section class="container">
          <div class="row">
            <div t-if="not sh_is_common_product" class="col-lg-12">
              <div style="max-height: 300px; overflow-y: auto; border: 1px solid #ddd; border-radius: 5px; padding: 5px;">
                <table class="table table-striped table-sm table-hover mb-0">
                  <thead>
                    <tr><th colspan="3" class="text-center">Compatible con:</th></tr>
                    <tr><th>Marca</th><th>Modelo</th><th>A√±o</th></tr>
                  </thead>
                  <tbody>
                    <t t-if="vehicles" t-foreach="vehicles" t-as="vehicle">
                      <tr>
                        <td><t t-if="vehicle.make_id" t-esc="vehicle.make_id.name"/></td>
                        <td><t t-if="vehicle.mmodel_id" t-esc="vehicle.mmodel_id.name"/></td>
                        <td><t t-if="vehicle.year" t-esc="vehicle.year"/></td>
                      </tr>
                    </t>
                  </tbody>
                </table>
              </div>
            </div>
            <div t-if="sh_is_common_product" class="col-lg-12">
              <div class="alert alert-success text-center">
                <strong>Este producto es compatible con todos los vehiculos</strong>
              </div>
            </div>
          </div>
        </section>
      </div>
    </xpath>
  </template>

  <!-- ‚úÖ Mantener filtros de moto -->
  <template id="products_attributes" inherit_id="website_sale.products_attributes" customize_show="False" active="True" name="Keep Motorcycle Attributes and Variants filters">
    <xpath expr="//input[@name='category']" position="after">
      <input t-if="not website.sh_do_not_consider_vehicle_over_attribute and motorcycle_type" type="hidden" name="type" t-att-value="motorcycle_type"/>
      <input t-if="not website.sh_do_not_consider_vehicle_over_attribute and motorcycle_make" type="hidden" name="make" t-att-value="motorcycle_make"/>
      <input t-if="not website.sh_do_not_consider_vehicle_over_attribute and motorcycle_model" type="hidden" name="model" t-att-value="motorcycle_model"/>
      <input t-if="not website.sh_do_not_consider_vehicle_over_attribute and motorcycle_year" type="hidden" name="year" t-att-value="motorcycle_year"/>
    </xpath>
  </template>

  <!-- üöÄ Buscador de motos + seleccionar veh√≠culo diferente -->
  <template id="override_motorcycle_search" inherit_id="website_sale.products" name="Compact horizontal motorcycle search">
    <xpath expr="//div[contains(@class,'oe_website_sale')]" position="before">

        <!-- üî≤ Container compacto -->
        <section class="container-fluid bg-light py-2 mb-3">
            <div class="container">
                
                <!-- üöò Cuando NO hay veh√≠culo seleccionado -->
                <t t-if="not motorcycle_heading">
                    <div class="text-center mb-2">
                        <h6 class="mb-1 text-muted">Seleccion√° tu Veh√≠culo</h6>
                        <small class="text-muted d-none d-md-block">Encontr√° repuestos espec√≠ficos para tu moto</small>
                    </div>

                    <form id="id_sh_motorcycle_search_form" action="/shop" method="get">
                        
                        <!-- Campos en l√≠nea horizontal -->
                        <div class="row g-1 mb-2">
                            <!-- Tipo -->
                            <div class="col-3">
                                <select name="type" id="id_sh_motorcycle_type" class="form-select form-select-sm" required="required">
                                    <option value="">Tipo</option>
                                </select>
                            </div>

                            <!-- Marca -->
                            <div class="col-3">
                                <select name="make" id="id_sh_motorcycle_make" class="form-select form-select-sm" required="required">
                                    <option value="">Marca</option>
                                </select>
                            </div>

                            <!-- A√±o -->
                            <div class="col-3">
                                <select name="year" id="id_sh_motorcycle_year" class="form-select form-select-sm" required="required">
                                    <option value="">A√±o</option>
                                </select>
                            </div>

                            <!-- Modelo -->
                            <div class="col-3">
                                <select name="model" id="id_sh_motorcycle_model" class="form-select form-select-sm" required="required">
                                    <option value="">Modelo</option>
                                </select>
                            </div>
                        </div>

                        <!-- Bot√≥n centrado -->
                        <div class="row">
                            <div class="col-12">
                                <button type="submit" class="btn btn-primary btn-sm w-100" style="background-color: #e74c3c; border-color: #e74c3c;">
                                    <i class="fa fa-search me-1"></i>Buscar
                                </button>
                            </div>
                        </div>

                    </form>
                </t>

                <!-- üõ† Cuando ya hay veh√≠culo seleccionado -->
                <t t-if="motorcycle_heading">
                  <div class="form-inline justify-content-center text-center">
                      <div class="motorcycle_heading_section">
                        <h4 class="text-center mt-3 text-primary">
                            Veh√≠culo seleccionado: <b><t t-esc="motorcycle_heading"/></b>
                        </h4>
                      </div>

                    <t t-if="request.session.uid and website.sh_is_show_garage">
                      <span id="id_sh_motorcycle_save_bike_to_garage_btn" class="btn ui-link link-primary"><i class="fa fa-plus"/> Save bike to garage</span>
                    </t>
                    <span id="id_sh_motorcycle_select_diff_bike_btn" class="btn ui-link link-secondary"><i class="fa fa-retweet"/> Seleccion√° un veh√≠culo diferente</span>

            </div>
        </section>

    </xpath>
</template>

  <!-- üè∑Ô∏è Badge mayorista en header -->
  <template id="sh_mayorista_badge_header" inherit_id="website.layout" active="True" name="Mayorista Badge Header">
    <xpath expr="//header[@id='top']" position="inside">
      <t t-if="website.sh_show_user_pricelist_badge and not request.env.user._is_public()">
        <t t-set="user_pricelist" t-value="request.env.user.partner_id.property_product_pricelist"/>
        <t t-if="user_pricelist">
          <div class="position-absolute" style="top: 10px; right: 10px; z-index: 1050;">
            <span class="badge bg-primary me-2">
              <i class="fa fa-star me-1"></i>
              <t t-esc="user_pricelist.name"/>
            </span>
          </div>
        </t>
      </t>
    </xpath>
  </template>

  <!-- üí∞ AGREGAR precios comparativos Y OCULTAR original cuando hay comparativos -->
  <template id="sh_mayorista_add_prices_grid" inherit_id="website_sale.products_item" active="True" name="Add Comparative Prices Grid">
    <!-- Ocultar el precio original cuando hay precios comparativos -->
    <xpath expr="//div[hasclass('product_price')]" position="attributes">
      <attribute name="t-attf-style">{{website.sh_show_comparative_prices and not request.env.user._is_public() and len(product.get_comparative_prices()) > 1 and 'display:none;' or ''}}</attribute>
    </xpath>
    
    <!-- Agregar DESPU√âS del precio original -->
    <xpath expr="//div[hasclass('product_price')]" position="after">
      <t t-if="website.sh_show_comparative_prices and not request.env.user._is_public()">
        <t t-set="comparative_prices" t-value="product.get_comparative_prices()"/>
        <t t-if="len(comparative_prices) > 1">
          <!-- Mostrar precios comparativos cuando hay m√∫ltiples listas diferentes -->
          <div class="sh-price-comparison-wrapper">
            <div class="sh-price-comparison">
              <t t-foreach="comparative_prices" t-as="price_info">
                <div t-att-class="'sh-price-user fw-bold' if price_info['is_user_pricelist'] else 'sh-price-other text-decoration-line-through'">
                  <t t-if="price_info['is_user_pricelist']">
                    <i class="fa fa-check-circle me-1"></i>
                  </t>
                  <span class="sh-price-label small"><t t-esc="price_info['name']"/>:</span>
                  <span class="sh-price-amount">$<t t-esc="'{:,.2f}'.format(price_info['price'])"/></span>
                </div>
              </t>
            </div>
          </div>
        </t>
      </t>
    </xpath>
  </template>  
  

<!-- üí∞ Precios comparativos en p√°gina individual de producto - VERSI√ìN CORREGIDA -->
<template id="sh_mayorista_product_page_prices_minimal" inherit_id="website_sale.product" name="Product Page Comparative Prices Minimal">
  <xpath expr="//h1" position="after">
    <t t-if="request.env.user.has_group('base.group_user')">
      <t t-set="comparatives" t-value="product.get_comparative_prices()"/>
      <t t-if="comparatives and len(comparatives) > 1">
        <div class="small text-muted mb-2">
          <t t-foreach="comparatives" t-as="entry">
            <t t-if="entry.get('is_user_pricelist')">
              <span class="text-success fw-bold">
                <i class="fa fa-check-circle me-1"></i>
                <t t-esc="entry.get('name', 'Tu precio')"/>: $<t t-esc="'{:,.0f}'.format(float(entry.get('price', 0)))"/>
              </span>
            </t>
            <t t-else="">
              <span class="text-decoration-line-through ms-2">
                <t t-esc="entry.get('name', 'Lista')"/>: $<t t-esc="'{:,.0f}'.format(float(entry.get('price', 0)))"/>
              </span>
            </t>
          </t>
        </div>
      </t>
    </t>
  </xpath>
</template>

<!-- üè∑Ô∏è Mostrar c√≥digo de variante en vista de producto -->
  <template id="sh_motorcycle_product_view_inherit" inherit_id="website_sale.product" name="Show default_code before product title">
    <xpath expr="//div[@id='product_details']/h1" position="before">
      <t t-if="product_variant and product_variant.default_code">
        <div id="variant_default_code" class="text-muted small mb-2">
          <strong>C√≥digo:</strong> <span t-esc="product_variant.default_code"/>
        </div>
      </t>
    </xpath>
  </template>



<!-- üè∑Ô∏è Mostrar c√≥digo de producto en grid -->
  <template id="sh_motorcycle_products_item_inherit" inherit_id="website_sale.products_item" name="Add default_code to product card (grid and list)">
    <xpath expr="//div[contains(@class,'o_wsale_product_information_text')]" position="before">
      <t t-if="product.default_code">
        <small class="text-muted d-block">C√≥digo: <t t-esc="product.default_code"/></small>
      </t>
    </xpath>


    <!-- Inserta el badge ¬´En stock¬ª sobre la imagen -->
    <xpath expr="//div[contains(@class,'oe_product_image')]" position="inside">
        <t t-if="product_qty_display">
            <span class="badge bg-success">
                <t t-esc="product_qty_display"/>
            </span>
            
        </t>

    </xpath>
  </template>   

</odoo>